<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="./css/style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <!-- jQueryUIのCDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js" integrity="sha512-57oZ/vW8ANMjR/KQ6Be9v/+/h6bq9/l3f0Oc7vn6qMqyhvPd1cvKBRWWpzu0QoneImqr2SkmO4MSqU+RpHom3Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/themes/base/jquery-ui.min.css" integrity="sha512-ELV+xyi8IhEApPS/pSj66+Jiw+sOT1Mqkzlh8ExXihe4zfqbWkxPRi8wptXIO9g73FSlhmquFlUOuMSoXz5IRw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

</head>
<body>
  <div class="main_visual" id="header">
    <img src="./image/morning/background_morning.svg" alt="昼の空">
    <img src="./image/morning/sun.svg" class="sun" alt="太陽">
    <img src="./image/morning/moon.svg" class="moon" alt="月">
    <div class="line"></div>
    <img src="./image/morning/tensen_morning.svg" class="dotted_line" alt="点線">
    <img src="./image/morning/cloud_left.svg" class="cloud_left" alt="雲_左">
    <img src="./image/morning/cloud_center_right.svg" class="cloud_right" alt="雲_右">
    <img src="./image/morning/cloud_center_left.svg" class="cloud_center_left" alt="雲_中央左">
    <img src="./image/morning/cloud_center_right.svg" class="cloud_center_right" alt="雲_中央右">
    <p class="main_visual_message">太陽が沈むと、夜が静かに訪れる</p>
  </div>

<script>
  $(function () {
    var $line = $(".line")
    var $sun = $(".sun")
    var $moon = $(".moon")

    
    function sunToMoon () {
      var lineWidth = $line.width()
      var lineHeight = $line.height()
      var radius = lineWidth / 2 // 半円の半径
      var centerX = $line.offset().left + radius // 半円の中心x座標
      var centerY = $line.offset().top + lineHeight // 半円の中心y座標
  
      var sunWidth = $sun.width() / 2 // sunの半径（画像の横幅の半分）
      var moonWidth = $moon.width() / 2 // moonの半径（画像の横幅の半分）
  
      // sunの初期位置
      var initialSunX = centerX - sunWidth
      var initialSunY = centerY - radius - sunWidth / 2
      // パーセンテージで初期位置をCSSに反映
      $sun.css({ 
          left: (initialSunX / $(window).width()) * 100 + "%", 
          top: (initialSunY / $(window).height()) * 100 + "%" 
      })
  
      // moonの初期位置
      var initialMoonX = centerX - radius - moonWidth / 2
      var initialMoonY = centerY - radius / 2
  
      $moon.css({ 
          left: (initialMoonX / $(window).width()) * 100 + "%", 
          top: (initialMoonY / $(window).height()) * 100 + "%" 
      })
  
      // sunとmoonの初期位置の角度差を計算
      var sunAngle = Math.atan2(initialSunY - centerY, initialSunX - centerX) // sunの初期角度
      var moonAngle = Math.atan2(initialMoonY - centerY, initialMoonX - centerX) // moonの初期角度
      var angleDifference = sunAngle - moonAngle + 0.28 // sunとmoonの初期角度差
      $sun.draggable({
          drag: function (event, ui) {
              // sunの座標
              var x = ui.position.left + sunWidth - centerX
              var y = centerY - (ui.position.top + sunWidth)
  
              // 半円の範囲 (-90° ~ 90°) の角度
              var angle = Math.atan2(y, x)
              if (angle < -Math.PI / 2) angle = -Math.PI / 2
              if (angle > Math.PI / 2) angle = Math.PI / 2
  
              // sunの新しい座標
              var newX = centerX + radius * Math.cos(angle) - sunWidth
              var newY = centerY - radius * Math.sin(angle) - sunWidth * 0.7
  
              // sunの位置を設定
              ui.position.left = newX
              ui.position.top = newY
  
              // moonの角度
              var moonNewAngle = angle + angleDifference // sunの角度から初期角度差を引く
  
              // moonの新しい座標
              var moonX = centerX + radius * Math.cos(moonNewAngle) - moonWidth * 0.7
              var moonY = centerY - radius * Math.sin(moonNewAngle) - moonWidth * 0.7
  
              // moonの位置を設定
              $moon.css({
                  left: (moonX / $(window).width()) * 100 + "%",
                  top: (moonY / $(window).height()) * 100 + "%"
              })
  
              // 月が中央上部にきたとき
              if ($moon.offset().left + moonWidth > centerX) {
                  $sun.draggable("disable")

                  $moon.css({
                    left: centerX - moonWidth,
                    top: centerY - radius - moonWidth * 0.75
                  })

                  // ナイトモードに変更（bodyにnightクラス追加）
                  $('body').addClass('night')

                  $sun.draggable('enable')
                }

                // ナイトモードの状態で、太陽が中央上部にきたとき
                if ($('body').hasClass('night') && ui.position.left + sunWidth == centerX) {
                  // ナイトモードを解除
                  $('body').removeClass('night')
                }
          },
          containment: "parent"
      })
    }

    sunToMoon()

    // ウィンドウ幅が変更された際も正しく動くように設定
    $(window).on('resize', function () {
      sunToMoon()
    })




  })
</script>
</body>
</html>